<% f.object.class.finder_schema.facets.each do |field_config| %>
  <% format_name = f.object.class.finder_schema.filter["format"].to_sym %>
  <% field = field_config["key"].to_sym %>
  <% if field_config.nil? %>
    <%= render layout: "shared/specialist_document_form_error", locals: { field: field } do %>
    <% end %>
  <% elsif field_config["type"] == "date" %>
    <% prefix = format_name %>
    <%= render "shared/datetime_fields", {
      prefix: prefix,
      field_name: "#{format_name}[#{field}]",
      date_only: true,
      # error_items: errors_for(consultation_response.errors, :published_on),
      year: {
        value: params.dig("#{prefix}", "#{field}(1i)"),
        id: "#{prefix}_#{field}_year",
        name: "#{prefix}[#{field}(1i)]",
        label: "Year",
        width: 4,
      },
      month: {
        value: params.dig("#{prefix}", "#{field}(2i)"),
        id: "#{prefix}_#{field}_month",
        name: "#{prefix}[#{field}(2i)]",
        label: "Month",
        width: 2,
      },
      day: {
        value: params.dig("#{prefix}", "#{field}(3i)"),
        id: "#{prefix}_#{field}_day",
        name: "#{prefix}[#{field}(3i)]",
        label: "Day",
        width: 2,
      },
    } %>
  <% elsif !field_config["allowed_values"] %>
    <%= render "govuk_publishing_components/components/textarea", {
      label: {
        text: field_config["name"]
      },
      name: "#{format_name}_#{field}",
      textarea_id: "#{format_name}_#{field}",
    } %>
  <% elsif field_config["specialist_publisher_properties"]["select"] == "one" %>
    <%= render "govuk_publishing_components/components/select", {
      id: "#{format_name}[#{field}]",
      label: field_config["name"],
      full_width: true,
      options: f.object.allowed_values(field).map do |item|
        {
          text: item["label"],
          value: item["value"]
        }
      end,
   } %>
  <% elsif field_config["specialist_publisher_properties"]["select"] == "multiple" %>
    <% destroy_checkbox = sanitize("
        <div class=\"govuk-checkboxes\" data-module=\"govuk-checkboxes\">
          <div class=\"govuk-checkboxes__item\">
            <input type=\"checkbox\" name=\"#{field_config["name"].downcase}[0][_destroy]\" id=\"#{field_config["name"].downcase}_0__destroy\" class=\"govuk-checkboxes__input\">
            <label for=\"#{field_config["name"].downcase}_0__destroy\" class=\"govuk-label govuk-checkboxes__label\">Delete</label>
          </div>
        </div>")
    %>
    <% name_lowercase = field_config["name"].downcase %>
    <% values = f.object.allowed_values(field) %>
    <%= render "govuk_publishing_components/components/heading", {
      text: field_config['name'],
      heading_level: 3,
      font_size: "s",
    } %>
    <%= render "govuk_publishing_components/components/add_another", {
      fieldset_legend: field_config['name'],
      add_button_text: "Add another category",
      items: [
        {
        fields: render("govuk_publishing_components/components/select", {
                  id: "#{name_lowercase}_0_#{field}",
                  label: "Select a #{name_lowercase}",
                  full_width: true,
                  options: values.map do |item|
                  {
                    text: item["label"],
                    value: item["value"]
                  }
                end}),
        destroy_checkbox: destroy_checkbox,
        }
      ],
      empty: render("govuk_publishing_components/components/select", {
                  id: "#{name_lowercase}_1_#{field}",
                  label: "Select a #{field_config["name"].downcase}",
                  full_width: true,
                  options: values.map do |item|
                  {
                    text: item["label"],
                    value: item["value"]
                  }
                end}),
    } %>
  <% else %>
    <%= render layout: "shared/specialist_document_form_error", locals: { field: field } do %>
    <% end %>
  <% end %>
<% end %>
