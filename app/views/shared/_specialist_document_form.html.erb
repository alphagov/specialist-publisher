<% f.object.class.finder_schema.facets.each do |field_config| %>
  <% format_name = f.object.class.finder_schema.filter["format"].to_sym %>
  <% field = field_config["key"].to_sym %>
  <% if field_config.nil? %>
    <%= render layout: "shared/specialist_document_form_error", locals: { field: field } do %>
    <% end %>
  <% elsif field_config["type"] == "date" %>
    <% prefix = format_name %>
    <%= render "shared/datetime_fields", {
      prefix: prefix,
      field_name: "#{format_name}[#{field}]",
      date_only: true,
      # error_items: errors_for(consultation_response.errors, :published_on),
      year: {
        value: params.dig("#{prefix}", "#{field}(1i)"),
        id: "#{prefix}_#{field}_year",
        name: "#{prefix}[#{field}(1i)]",
        label: "Year",
        width: 4,
      },
      month: {
        value: params.dig("#{prefix}", "#{field}(2i)"),
        id: "#{prefix}_#{field}_month",
        name: "#{prefix}[#{field}(2i)]",
        label: "Month",
        width: 2,
      },
      day: {
        value: params.dig("#{prefix}", "#{field}(3i)"),
        id: "#{prefix}_#{field}_day",
        name: "#{prefix}[#{field}(3i)]",
        label: "Day",
        width: 2,
      },
    } %>
  <% elsif !field_config["allowed_values"] %>
    <%= render "govuk_publishing_components/components/textarea", {
      label: {
        text: field_config["name"],
        heading_size: "m",
      },
      name: "#{format_name}[#{field}]",
      rows: 3,
      textarea_id: "#{format_name}_#{field}",
    } %>
  <% elsif field_config["specialist_publisher_properties"]["select"] == "one" %>
    <%= render "govuk_publishing_components/components/select", {
      id: "#{format_name}_#{field}",
      name: "#{format_name}[#{field}]",
      label: field_config["name"],
      heading_size: "m",
      full_width: true,
      options: f.object.allowed_values(field).map do |item|
        {
          text: item["label"],
          value: item["value"]
        }
      end,
   } %>
  <% elsif field_config["specialist_publisher_properties"]["select"] == "multiple" %>
    <%= render layout: "shared/form_group", locals: { f: f, field: field, label: field_config["name"] } do %>
      <%= f.select field,
                   select_options_for_facet(f.object.allowed_values(field)),
                   {},
                   {
                     class: 'select2 form-control',
                     multiple: true,
                     data: {
                       placeholder: "Select #{field_config["name"].downcase}"
                     }
                   }
      %>
    <% end %>
  <% else %>
    <%= render layout: "shared/specialist_document_form_error", locals: { field: field } do %>
    <% end %>
  <% end %>
<% end %>
